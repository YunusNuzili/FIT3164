
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Optimisation and Analysis Team 10</title>
    <!-- CSS file -->
    <link rel="stylesheet" type="text/css" href="styles.css" media="all">
    <style>
        canvas {
            background-color: white;
        }
        
    </style>
</head>
<body onload="showSection('home')">
    <header>
        <h1>Pricing Optimisation and Analysis Team 10</h1>
        <nav>
            <ul>
                <li><a href="#home" onclick="showSection('home')">Home</a></li>
                <li><a href="#about" onclick="showSection('about')">About</a></li>
                <li><a href="#services" onclick="showSection('services')">Services</a></li>
                <li><a href="#contact" onclick="showSection('contact')">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section id="home">
        <h2>Quickly and automatically adjust pricing for retail items</h2>
        <p>This web application is a price optimization system that can use historical sales data, product attributes and 
            pricing information to determine the optimal pricing point and identify the relationship between price and sales 
            demand. This will help retail businesses gain a competitive advantage and increase sales efficiency to make better 
            decisions for higher profits</p>
        <button class="button" onclick="showSection('services')">GET STARTED</button>
    </section>

    <section id="about" style="display: none;">
        <h2>About Us</h2>
        <p>We are team 10, below is all the members for our team.
            <br>Yongkang Liu 30761840
            <br>Mohamed Yunus Nuzili 32795947 
            <br>Brandon Yap 30884977
            <br>Yinghua Sun 28981510
        </p>      
        <p>This is Project 5, which is Pricing Optimization and Analysis. This project aims to optimize pricing strategies for 
            retail products. In some retail sectors, the old methods of forecasting sales just do not work anymore. In the market 
            today, we need an approach that precisely targets the improvement of pricing strategies to increase profit margins and 
            market position.  This is all about how pricing changes can push sales and get more customers by using some high-level 
            data analytics and model building. </p>

    </section>

    <section id="services" style="display: none;">
        <h2>Our Services</h2>
        <p>Enter information to filter.</p>
        
        <!-- Item ID Input -->
        <label for="itemId">Item ID:</label>
        <input type="text" id="itemId" name="itemId">
    
        <!-- Store ID Select -->
        <label for="storeId">Store ID:</label>
        <select id="storeId" name="storeId">
            <option value="CA_1">CA_1</option>
            <option value="CA_2">CA_2</option>
            <option value="CA_3">CA_3</option>
            <option value="CA_4">CA_4</option>
            <option value="TX_1">TX_1</option>
            <option value="TX_2">TX_2</option>
            <option value="TX_3">TX_3</option>
            <option value="WI_1">WI_1</option>
            <option value="WI_2">WI_2</option>
            <option value="WI_3">WI_3</option>
        </select>

        <!-- Current Date Input -->
        <label for="currentDate">Current Date:</label>
        <input type="text" id="currentDate" name="currentDate">
    
        <!-- Target Sales Date Input -->
        <label for="targetSalesDate">Target Sales Date:</label>
        <input type="text" id="targetSalesDate" name="targetSalesDate">

    
        <!-- Submit Button -->
        <button onclick="submitForm()">Submit</button>
    
        <!-- Result Section (Initially Hidden) -->
        <div id="resultSection" style="display: none;">
            <h2>Result</h2>
            <div id="visualization"></div>
            <canvas id="priceChart"></canvas>
            <p id="suggestion"></p>
        </div>

        
        
    </section>
    
    <div id="resultSection" style="display: none;">
        <h2>Result</h2>
        <div id="visualization"></div>
        <canvas id="priceChart"></canvas>
        <p id="suggestion"></p>
    </div>

    <footer>
        <p>&copy; Team 10</p>
    </footer>

    <script>
        function showSection(sectionId) {
            // hide all section
            var sections = document.querySelectorAll('section');
            sections.forEach(function(section) {
                section.style.display = 'none';
            });

            // show all section
            var sectionToShow = document.getElementById(sectionId);
            if(sectionToShow) {
                sectionToShow.style.display = 'block';
            }
        }

        function submitForm() {
            // Get input values
            var itemId = document.getElementById("itemId").value;
            var storeId = document.getElementById("storeId").value;
            var targetSalesDate = document.getElementById("targetSalesDate").value;
            var currentDate = document.getElementById("currentDate").value;
            
            
            // Check if the values are valid
            if (itemId === "" || storeId === "" || targetSalesDate === "" || currentDate === "") {
                alert("Please enter ");
                return; // If any input is empty, stop
            }
            
            // Check if the date format and Target date after current date
            var dateRegex = /^\d{2}\/\d{2}\/\d{4}$/; // dd/mm/yy format
            if (!dateRegex.test(targetSalesDate) || !dateRegex.test(currentDate)) {
                alert("format: 'dd/mm/yyyy' ");
                return; // if invaid stop
            }
            
            var targetSalesDateParts = targetSalesDate.split("/");
            var currentDateParts = currentDate.split("/");
            
            var targetSalesDateObj = new Date(targetSalesDateParts[2], targetSalesDateParts[1] - 1, targetSalesDateParts[0]); // day,month,year value, starting from 0
            var currentDateObj = new Date(currentDateParts[2], currentDateParts[1] - 1, currentDateParts[0]); // day,month,year value, starting from 0
            
            if (currentDateObj >= targetSalesDateObj) {
                alert("Target Sales Date must after Current Date");
                return; // if inviaid,stop
            }

            // Check if targetSalesDateObj year is same as currentDateObj year
            if (currentDateObj.getFullYear() !== targetSalesDateObj.getFullYear()) {
                alert("Target Sales Date year must be the same as Current Date year.");
                return; // If invalid, stop
            }

            // Check itemID
            var regex = /^[a-zA-Z]+_\d{1}_\d{3}$/;
            if (regex.test(itemId)) {

            } else {
                alert("Invalid itemID format. Please enter a valid itemID in the format 'DEPT_X_XXX'.\n DEPT includes [HOBBIES,HOUSEHOLD,FOODS]");
            }
            var formData = {
                itemId: itemId,
                storeId: storeId,
                targetSalesDate: targetSalesDate,
                currentDate: currentDate,
            };

            // Send an AJAX request to your Flask endpoint
            fetch('http://127.0.0.1:5000/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                displayResults(data);
            })
            .catch(error => console.error('Error:', error));
        }


        function displayResults(data) {
    var resultSection = document.getElementById("resultSection");
    resultSection.style.display = "block";
    
    // Create a container for the original price detail only and insert below the "Result" header
    var originalPriceDetail = document.createElement('div');
originalPriceDetail.className = 'original-price-detail';
originalPriceDetail.innerHTML = 
    '<span class="price-detail">Original Price: $<span class="price">' + data.base_price + '</span></span>';
var header = document.querySelector('#resultSection h2');
header.parentNode.insertBefore(originalPriceDetail, header.nextSibling);


    // Existing code for optimized price and discount rate in the suggestion element
    var suggestionElement = document.getElementById("suggestion");
    suggestionElement.innerHTML = 
        '<div class="price-header">Suggested optimal price and discount rate:</div>' +
        '<span class="price-detail">Optimized Price: $<span class="price">' + data.optimized_price + '</span></span>' +
        '<span class="price-detail">Discount Rate: <span class="price">' + data.discount + '%</span></span>';

    // Existing code for visualization and chart
    var ctx = document.getElementById('priceChart').getContext('2d');
    if (window.myChart) {
        window.myChart.destroy();
    }
    window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.x_pred,
            datasets: [{
                label: 'Predicted Sales Change vs. Price Change',
                data: data.y_pred,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            },{
                label: 'Sales Changes',
                data: data.y_values.map((value, index) => ({ x: data.x_values[index], y: value })),
                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                pointRadius: 10,
                pointHoverRadius: 8,
                showLine: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: 'Sales Change(%)',
                        color: '#111',
                        font: {
                            size: 16
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Price Change(%)',
                        color: '#111',
                        font: {
                            size: 16
                        }
                    }
                }
            }
        }
    });
}




        
    </script>
</body>
</html>